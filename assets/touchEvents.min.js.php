<?php

/*
 * Touch Events JS package for Bear Framework
 * https://github.com/ivopetkov/touch-events-js-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */

return <<<'EOT'
var ivoPetkov=ivoPetkov||{};ivoPetkov.bearFrameworkAddons=ivoPetkov.bearFrameworkAddons||{},ivoPetkov.bearFrameworkAddons.touchEvents=ivoPetkov.bearFrameworkAddons.touchEvents||function(){var n=()=>{if(void 0!==EventTarget&&void 0!==EventTarget.constructor)try{return new EventTarget}catch(n){}var n=[];return{addEventListener:(e,t)=>{e in n||(n[e]=[]),n[e].push(t)},removeEventListener:(e,t)=>{if(e in n)for(var r=n[e],o=0,i=r.length;o<i;o++)if(r[o]===t)return void r.splice(o,1)},dispatchEvent:e=>{if(!(e.type in n))return!0;for(var t=n[e.type].slice(),r=0,o=t.length;r<o;r++)t[r].call(this,e);return!e.defaultPrevented}}},e=function(n,e){if(null!==e&&null!==n)for(var t=e.parentNode;null!==t;){if(t===n)return!0;t=t.parentNode}return!1},t=function(n,e){var t=n.clientX,r=n.clientY,o=e.clientX,i=e.clientY;return Math.round(Math.sqrt(Math.pow(Math.abs(o-t),2)+Math.pow(Math.abs(i-r),2)))};return{addZoom:function(r,o){void 0===o&&(o=r),o.addEventListener("touchstart",(function(n){r.contains(n.target)&&n.stopPropagation()}),{passive:!1}),o.addEventListener("touchmove",(function(n){r.contains(n.target)&&n.preventDefault()}),{passive:!1});var i=n(),v=[],a=null,d=1,c=function(n){for(var e in v){v[e].downEvent.pointerId===n.pointerId&&(v.splice(e,1),1===v.length&&(t=void 0,(t=new Event("end")).change=d,i.dispatchEvent(t)))}var t};return r.addEventListener("pointerdown",(function(n){for(var e in v)if(v[e].downEvent.pointerId===n.pointerId)return;v.push({downEvent:n,moveEvent:n}),2===v.length&&function(){for(var n=0;n<v.length;n++){var e=v[n];e.downEvent=e.moveEvent}a=t(v[0].downEvent,v[1].downEvent);var r=new Event("start");i.dispatchEvent(r)}()})),o.addEventListener("pointermove",(function(n){if(2===v.length){for(var e=0;e<2;e++){var r=v[e];r.downEvent.pointerId===n.pointerId&&(r.moveEvent=n)}var o=t(v[0].moveEvent,v[1].moveEvent);d=o/a;var c=new Event("change");c.change=d,i.dispatchEvent(c)}})),o.addEventListener("pointerup",c),o.addEventListener("pointercancel",c),o.addEventListener("pointerout",(function(n){e(o,n.target)||c(n)})),o.addEventListener("pointerleave",c),i},addMove:function(t,r){void 0===r&&(r=t),r.addEventListener("touchstart",(function(n){t.contains(n.target)&&n.stopPropagation()}),{passive:!1}),r.addEventListener("touchmove",(function(n){t.contains(n.target)&&n.preventDefault()}),{passive:!1});var o=n(),i=[],v=[0,0],a=[0,0],d=function(n){var e=i.length;if(1===e){var t=n?i[0].downEvent:i[0].moveEvent;return[t.clientX,t.clientY]}if(e>1){var r=n?i[0].downEvent:i[0].moveEvent,o=n?i[1].downEvent:i[1].moveEvent;return[r.clientX-(r.clientX-o.clientX)/2,r.clientY-(r.clientY-o.clientY)/2]}return[0,0]},c=function(){v=d(!0);var n=new Event("start");o.dispatchEvent(n)},p=function(){var n=new Event("end");n.changeX=a[0],n.changeY=a[1],o.dispatchEvent(n),a=[0,0];for(var e=0;e<i.length;e++){var t=i[e];t.downEvent=t.moveEvent}},s=function(n){for(var e in i){i[e].downEvent.pointerId===n.pointerId&&(i.splice(e,1),p(),i.length>0&&c())}};return t.addEventListener("pointerdown",(function(n){for(var e in i)if(i[e].downEvent.pointerId===n.pointerId)return;i.push({downEvent:n,moveEvent:n}),i.length>1&&p(),c()})),r.addEventListener("pointermove",(function(n){for(var e=0;e<i.length;e++){var t=i[e];t.downEvent.pointerId===n.pointerId&&(t.moveEvent=n)}if(0!==i.length){var r=d(!1);a=[Math.round(r[0]-v[0]),Math.round(r[1]-v[1])];var c=new Event("change");c.changeX=a[0],c.changeY=a[1],o.dispatchEvent(c)}})),r.addEventListener("pointerup",s),r.addEventListener("pointercancel",s),r.addEventListener("pointerout",(function(n){e(r,n.target)||s(n)})),r.addEventListener("pointerleave",s),o},addDoubleTap:function(e){var t=n(),r=[],o=[];return e.addEventListener("pointerdown",(function(n){for(var e in r)if(r[e].pointerId===n.pointerId)return;r.push(n),1===r.length&&o.push([0,(new Date).getTime()])})),e.addEventListener("pointerup",(function(n){for(var e in r){if(r[e].pointerId===n.pointerId&&(r.splice(e,1),0===r.length)){o.push([1,(new Date).getTime()]);var i=o.length-4;if(i<0&&(i=0),4===(o=o.slice(i)).length){for(var v=0,a=1;a<=o.length;a++)v+=a*o[a-1][0];if(6===v&&o[3][1]-o[0][1]<500){var d=new Event("done");t.dispatchEvent(d)}}}}})),t},addSwipe:function(t,r){void 0===r&&(r=t),r.addEventListener("touchstart",(function(n){t.contains(n.target)&&n.stopPropagation()}),{passive:!1}),r.addEventListener("touchmove",(function(n){t.contains(n.target)&&n.preventDefault()}),{passive:!1});var o=n(),i=[],v=[0,0,null],a=null,d=function(n){for(var e in i){if(i[e].downEvent.pointerId===n.pointerId){i.splice(e,1);var t=new Event("end");t.changeX=v[0],t.changeY=v[1],t.direction=v[2],o.dispatchEvent(t),v=[0,0,null],a=null}}};return t.addEventListener("pointerdown",(function(n){if(1!==i.length){for(var e in i)if(i[e].downEvent.pointerId===n.pointerId)return;i.push({downEvent:n,moveEvent:n}),a=!1}})),r.addEventListener("pointermove",(function(n){for(var e=0;e<i.length;e++){var t=i[e];t.downEvent.pointerId===n.pointerId&&(t.moveEvent=n)}if(0!==i.length){if(!1===a){var r=new Event("start");o.dispatchEvent(r),a=!0}var d=i[0],c=d.moveEvent.clientX-d.downEvent.clientX,p=d.moveEvent.clientY-d.downEvent.clientY,s=null;s=Math.abs(c)>Math.abs(p)?c<0?"left":"right":p<0?"up":"down",(r=new Event("change")).changeX=c,r.changeY=p,r.direction=s,o.dispatchEvent(r),v=[c,p,s]}})),r.addEventListener("pointerup",d),r.addEventListener("pointercancel",d),r.addEventListener("pointerout",(function(n){e(r,n.target)||d(n)})),r.addEventListener("pointerleave",d),o}}}();
EOT;
