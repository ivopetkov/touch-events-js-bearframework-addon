<?php

/*
 * Touch Events JS package for Bear Framework
 * https://github.com/ivopetkov/touch-events-js-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */

return <<<'EOT'
var ivoPetkov=ivoPetkov||{};ivoPetkov.bearFrameworkAddons=ivoPetkov.bearFrameworkAddons||{},ivoPetkov.bearFrameworkAddons.touchEvents=ivoPetkov.bearFrameworkAddons.touchEvents||function(){var n=()=>{if(void 0!==EventTarget&&void 0!==EventTarget.constructor)try{return new EventTarget}catch(n){}var n=[];return{addEventListener:(e,t)=>{e in n||(n[e]=[]),n[e].push(t)},removeEventListener:(e,t)=>{if(e in n)for(var r=n[e],i=0,o=r.length;i<o;i++)if(r[i]===t)return void r.splice(i,1)},dispatchEvent:e=>{if(!(e.type in n))return!0;for(var t=n[e.type].slice(),r=0,i=t.length;r<i;r++)t[r].call(this,e);return!e.defaultPrevented}}},e=function(n,e){if(null!==e&&null!==n)for(var t=e.parentNode;null!==t;){if(t===n)return!0;t=t.parentNode}return!1},t=function(n,e){var t=n.clientX,r=n.clientY,i=e.clientX,o=e.clientY;return Math.round(Math.sqrt(Math.pow(Math.abs(i-t),2)+Math.pow(Math.abs(o-r),2)))};return{addZoom:function(r,i){void 0===i&&(i=r),i.addEventListener("touchstart",(function(n){r.contains(n.target)&&n.preventDefault()}),{passive:!1});var o=n(),v=[],a=null,d=1,c=function(n){for(var e in v){v[e].downEvent.pointerId===n.pointerId&&(v.splice(e,1),1===v.length&&(t=void 0,(t=new Event("end")).change=d,o.dispatchEvent(t)))}var t};return r.addEventListener("pointerdown",(function(n){for(var e in v)if(v[e].downEvent.pointerId===n.pointerId)return;v.push({downEvent:n,moveEvent:n}),2===v.length&&function(){for(var n=0;n<v.length;n++){var e=v[n];e.downEvent=e.moveEvent}a=t(v[0].downEvent,v[1].downEvent);var r=new Event("start");o.dispatchEvent(r)}()})),i.addEventListener("pointermove",(function(n){if(2===v.length){for(var e=0;e<2;e++){var r=v[e];r.downEvent.pointerId===n.pointerId&&(r.moveEvent=n)}var i=t(v[0].moveEvent,v[1].moveEvent);d=i/a;var c=new Event("change");c.change=d,o.dispatchEvent(c)}})),i.addEventListener("pointerup",c),i.addEventListener("pointercancel",c),i.addEventListener("pointerout",(function(n){e(i,n.target)||c(n)})),i.addEventListener("pointerleave",c),o},addMove:function(t,r){void 0===r&&(r=t),r.addEventListener("touchstart",(function(n){t.contains(n.target)&&n.preventDefault()}),{passive:!1});var i=n(),o=[],v=[0,0],a=[0,0],d=function(n){var e=o.length;if(1===e){var t=n?o[0].downEvent:o[0].moveEvent;return[t.clientX,t.clientY]}if(e>1){var r=n?o[0].downEvent:o[0].moveEvent,i=n?o[1].downEvent:o[1].moveEvent;return[r.clientX-(r.clientX-i.clientX)/2,r.clientY-(r.clientY-i.clientY)/2]}return[0,0]},c=function(){v=d(!0);var n=new Event("start");i.dispatchEvent(n)},E=function(){var n=new Event("end");n.changeX=a[0],n.changeY=a[1],i.dispatchEvent(n),a=[0,0];for(var e=0;e<o.length;e++){var t=o[e];t.downEvent=t.moveEvent}},u=function(n){for(var e in o){o[e].downEvent.pointerId===n.pointerId&&(o.splice(e,1),E(),o.length>0&&c())}};return t.addEventListener("pointerdown",(function(n){for(var e in o)if(o[e].downEvent.pointerId===n.pointerId)return;o.push({downEvent:n,moveEvent:n}),o.length>1&&E(),c()})),r.addEventListener("pointermove",(function(n){for(var e=0;e<o.length;e++){var t=o[e];t.downEvent.pointerId===n.pointerId&&(t.moveEvent=n)}if(0!==o.length){var r=d(!1);a=[Math.round(r[0]-v[0]),Math.round(r[1]-v[1])];var c=new Event("change");c.changeX=a[0],c.changeY=a[1],i.dispatchEvent(c)}})),r.addEventListener("pointerup",u),r.addEventListener("pointercancel",u),r.addEventListener("pointerout",(function(n){e(r,n.target)||u(n)})),r.addEventListener("pointerleave",u),i},addDoubleTap:function(e){var t=n(),r=[],i=[];return e.addEventListener("pointerdown",(function(n){for(var e in r)if(r[e].pointerId===n.pointerId)return;r.push(n),1===r.length&&i.push([0,(new Date).getTime()])})),e.addEventListener("pointerup",(function(n){for(var e in r){if(r[e].pointerId===n.pointerId&&(r.splice(e,1),0===r.length)){i.push([1,(new Date).getTime()]);var o=i.length-4;if(o<0&&(o=0),4===(i=i.slice(o)).length){for(var v=0,a=1;a<=i.length;a++)v+=a*i[a-1][0];if(6===v&&i[3][1]-i[0][1]<500){var d=new Event("done");t.dispatchEvent(d)}}}}})),t},addSwipe:function(t,r){void 0===r&&(r=t),r.addEventListener("touchstart",(function(n){t.contains(n.target)&&n.preventDefault()}),{passive:!1});var i=n(),o=[],v=[0,0,null],a=null,d=function(n){for(var e in o){if(o[e].downEvent.pointerId===n.pointerId){o.splice(e,1);var t=new Event("end");t.changeX=v[0],t.changeY=v[1],t.direction=v[2],i.dispatchEvent(t),v=[0,0,null],a=null}}};return t.addEventListener("pointerdown",(function(n){if(1!==o.length){for(var e in o)if(o[e].downEvent.pointerId===n.pointerId)return;o.push({downEvent:n,moveEvent:n}),a=!1}})),r.addEventListener("pointermove",(function(n){for(var e=0;e<o.length;e++){var t=o[e];t.downEvent.pointerId===n.pointerId&&(t.moveEvent=n)}if(0!==o.length){if(!1===a){var r=new Event("start");i.dispatchEvent(r),a=!0}var d=o[0],c=d.moveEvent.clientX-d.downEvent.clientX,E=d.moveEvent.clientY-d.downEvent.clientY,u=null;u=Math.abs(c)>Math.abs(E)?c<0?"left":"right":E<0?"up":"down",(r=new Event("change")).changeX=c,r.changeY=E,r.direction=u,i.dispatchEvent(r),v=[c,E,u]}})),r.addEventListener("pointerup",d),r.addEventListener("pointercancel",d),r.addEventListener("pointerout",(function(n){e(r,n.target)||d(n)})),r.addEventListener("pointerleave",d),i}}}();
EOT;
